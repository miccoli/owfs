language: c

os:
  - linux
  - osx

dist: trusty

# osx_image: xcode9.3 # fail install of php
osx_image: xcode9.2

compiler:
  - clang
  - gcc

php:
  - '5.6'
  - '7.1'

addons:
  apt:
    packages:
# only have check 0.9 on trusty.
#    - check
# Only have libusb-dev 0.1.. we want 0.9.1+
#    - libusb-dev
    - libavahi-client-dev
    - swig3.0
    - fuse

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install swig; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install php; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install check; fi

before_script:
  - ./bootstrap

script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./configure SWIG=/usr/bin/swig3.0 ; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./configure; fi
  - make -j 2
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then make check; fi
